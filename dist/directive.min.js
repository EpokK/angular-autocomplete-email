/*!
 * angular-directive-boilerplate
 * 
 * Version: 0.0.8 - 2015-03-31T07:09:20.262Z
 * License: MIT
 */
"use strict";angular.module("angular-autocomplete-email",[]).filter("autocompleteFilter",function(){return function(e,a){var n=[];if(a&&a.length>0)for(var t=e.length-1;t>=0;t--){var l=e[t];"undefined"!=typeof l.value&&(-1!==l.value.toLowerCase().indexOf(a.toLowerCase())||-1!==l.label.toLowerCase().indexOf(a.toLowerCase()))&&n.push(l)}return n.sort(function(e,n){return e.label.toLowerCase().score(a)+e.value.toLowerCase().score(a)<n.label.toLowerCase().score(a)+n.value.toLowerCase().score(a)}),n}}).directive("autocompleteEmail",function(e,a){var n=/([.^\S]+@[.^\S]+\.[.^\S]+)/gi,t=9,l=13,o=8,i=38,r=40,s=function(e,a){var n;return n=e.length>0?e:a},u=function(e,a){var n;return n=e.length>0?e+" <"+a+">":a},m=function(e){return e.replace(/</g,"").replace(/>/g,"").replace(/"/g,"").replace(/'/g,"").replace(/,/g,"").trim()},c=function(e){var a=[],t=e.match(n);return a=t?t:[]},p=function(e,a,n){var t=c(e);if(a=a||[],t)for(var l=e,o=0;o<t.length;o++)if(l){var i=m(t[o]),r=l.split(i),p=m(r[0]),d={value:u(p,i),label:s(p,i),edit:!1};0===o&&n>=0?a[n]=d:a.push(d),l=r[1]}return a};return{restrict:"EA",templateUrl:"../src/input.html",replace:!0,scope:{emails:"=",autocomplete:"="},link:function(n,s){n.params={newValue:"",autocompleteFiltered:[],selected:null},n.onSubmit=function(e){var a=n.emails.indexOf(e),t=angular.copy(n.params.newValue),l=(n.emails.length,p(t,n.emails,a));l.length?n.emails=l:n.onRemove(n.emails.indexOf(e))},n.onBlur=function(e){var a=c(n.params.newValue);a.length>0?null!==n.params.selected?(n.onAddEmail(n.params.autocompleteFiltered[n.params.selected]),n.onRemove(n.emails.indexOf(e))):n.onSubmit(e,!1):n.onRemove(n.emails.indexOf(e))},n.onEdit=function(e){e.edit=!0,n.params.newValue=angular.copy(e.value)},n.onRemove=function(e){n.emails.splice(e,1),n.params.newValue="",n.onChange()},n.onMouseDown=function(e){n.onClick(e)},n.createNewInput=function(){e(function(){var e=n.getLastInput();n.params.newValue="",n.onChange(),angular.isDefined(e)||n.emails.push({value:"",label:"",edit:!0}),n.focusLastInput()})},n.onClick=function(e){e.target==s[0].firstElementChild&&n.createNewInput()},n.onAddEmail=function(e){n.emails.push({value:e.value,label:e.label,edit:!1}),n.params.newValue="",n.onChange()},n.onClose=function(){n.params.selected=null},n.onOpen=function(){n.params.selected=0},n.getLastInput=function(){var e=s.find("input"),a=e.length;return e[a-1]},n.focusLastInput=function(){e(function(){var e=n.getLastInput();e&&n.getLastInput().focus()},200)},n.onChange=function(){n.params.autocompleteFiltered=a("autocompleteFilter")(n.autocomplete,n.params.newValue),n.params.autocompleteFiltered.length>0?n.onOpen():n.onClose()},n.onKeyDown=function(e){switch(e.keyCode){case o:var a=n.params.newValue,s=n.emails;0===a.length&&s.length>0&&this.onRemove(s.length-2);break;case r:case i:case t:case l:e.preventDefault(),e.stopPropagation()}},n.onKeyUp=function(e,a){switch(e.keyCode){case l:case t:null!==n.params.selected?(n.onAddEmail(n.params.autocompleteFiltered[n.params.selected]),n.onRemove(n.emails.indexOf(a))):n.onSubmit(a,!0),n.createNewInput();break;case r:n.params.autocompleteFiltered.length>0&&(null===n.params.selected?n.params.selected=0:n.params.autocompleteFiltered.length>0&&n.params.selected<n.params.autocompleteFiltered.length-1&&n.params.selected++);break;case i:n.params.autocompleteFiltered.length>0&&(n.params.selected>1?n.params.selected--:n.params.selected=0)}}}}}),angular.module("angular-autocomplete-email").run(["$templateCache",function(e){e.put("input.html",'<div class="container-email"><div class="input-email" ng-mousedown="onMouseDown($event)"><span ng-repeat="email in emails" class="email"><span class="label-email" ng-attr-title="{{email.value}}" ng-dblclick="onEdit(email)" ng-if="!!!email.edit"><span>{{email.label}}</span> <a ng-click="onRemove($index)">x</a></span><form class="form-email" ng-submit="onSubmit(email, true)" ng-if="!!email.edit"><input class="edit-email" type="text" ng-model="params.newValue" ng-blur="onBlur(email)" ng-keydown="onKeyDown($event, email)" ng-keyup="onKeyUp($event, email)" ng-change="onChange()"></form></span></div><ul class="autocomplete-email" ng-if="params.autocompleteFiltered.length"><li ng-repeat="email in params.autocompleteFiltered"><a href="" ng-mousedown="onAddEmail(email)" ng-class="{\'selected\': $index === params.selected}">{{email.value}}</a></li></ul></div>')}]);