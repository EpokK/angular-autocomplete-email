/*!
 * angular-directive-boilerplate
 * 
 * Version: 0.0.8 - 2015-03-30T20:43:50.254Z
 * License: MIT
 */
"use strict";angular.module("angular-autocomplete-email",[]).filter("autocompleteFilter",function(){return function(e,a){var t=[];if(a&&a.length>0)for(var n=e.length-1;n>=0;n--){var l=e[n];"undefined"!=typeof l.value&&(-1!==l.value.toLowerCase().indexOf(a.toLowerCase())||-1!==l.label.toLowerCase().indexOf(a.toLowerCase()))&&t.push(l)}return t.sort(function(e,t){return e.label.toLowerCase().score(a)+e.value.toLowerCase().score(a)<t.label.toLowerCase().score(a)+t.value.toLowerCase().score(a)}),t}}).directive("autocompleteEmail",function(e,a){var t=/([.^\S]+@[.^\S]+\.[.^\S]+)/gi,n=9,l=13,o=8,i=38,r=40,s=function(e,a){var t;return t=e.length>0?e:a},u=function(e,a){var t;return t=e.length>0?e+" <"+a+">":a},m=function(e){return e.replace(/</g,"").replace(/>/g,"").replace(/"/g,"").replace(/'/g,"").replace(/,/g,"").trim()},c=function(e){var a=[],n=e.match(t);return a=n?n:[]},p=function(e,a,t){var n=c(e);if(a=a||[],n)for(var l=e,o=0;o<n.length;o++)if(l){var i=m(n[o]),r=l.split(i),p=m(r[0]),d={value:u(p,i),label:s(p,i),edit:!1};0===o&&t>=0?a[t]=d:a.push(d),l=r[1]}return a};return{restrict:"EA",templateUrl:"../src/input.html",replace:!0,scope:{emails:"=",autocomplete:"="},link:function(t,s){t.params={newValue:"",autocompleteFiltered:[],selected:null},t.onSubmit=function(e){var a=t.emails.indexOf(e),n=angular.copy(t.params.newValue),l=(t.emails.length,p(n,t.emails,a));l.length?t.emails=l:(t.params.newValue="",t.onRemove(t.emails.indexOf(e)))},t.selectFirstAutocomplete=function(){},t.onBlur=function(e){var a=c(t.params.newValue);a.length>0?null!==t.params.selected?(t.onAddEmail(t.params.autocompleteFiltered[t.params.selected]),t.onRemove(t.emails.indexOf(e))):t.onSubmit(e,!1):t.onRemove(t.emails.indexOf(e)),t.createNewInput()},t.onEdit=function(e){e.edit=!0,t.params.newValue=angular.copy(e.value)},t.onRemove=function(e){t.emails.splice(e,1)},t.onMouseDown=function(e){t.onClick(e)},t.createNewInput=function(){e(function(){var e=t.getLastInput();t.params.newValue="",angular.isDefined(e)||t.emails.push({value:"",label:"",edit:!0}),t.focusLastInput()})},t.onClick=function(e){e.target==s[0].firstElementChild&&t.createNewInput()},t.onAddEmail=function(e){t.emails.push({value:e.value,label:e.label,edit:!1}),t.params.newValue="",t.onChange()},t.onClose=function(){t.params.selected=null},t.onOpen=function(){t.params.selected=0},t.getLastInput=function(){var e=s.find("input"),a=e.length;return e[a-1]},t.focusLastInput=function(){e(function(){var e=t.getLastInput();e&&t.getLastInput().focus()},200)},t.onChange=function(){t.params.autocompleteFiltered=a("autocompleteFilter")(t.autocomplete,t.params.newValue),t.params.autocompleteFiltered.length>0?t.onOpen():t.onClose()},t.onKeyDown=function(e){switch(e.keyCode){case o:var a=t.params.newValue,s=t.emails;0===a.length&&s.length>0&&this.onRemove(s.length-2);break;case r:case i:case n:case l:e.preventDefault(),e.stopPropagation()}},t.onKeyUp=function(e,a){switch(e.keyCode){case l:case n:null!==t.params.selected?(t.onAddEmail(t.params.autocompleteFiltered[t.params.selected]),t.onRemove(t.emails.indexOf(a))):t.onSubmit(a,!0),t.createNewInput();break;case r:t.params.autocompleteFiltered.length>0&&(null===t.params.selected?t.params.selected=0:t.params.autocompleteFiltered.length>0&&t.params.selected<t.params.autocompleteFiltered.length-1&&t.params.selected++);break;case i:t.params.autocompleteFiltered.length>0&&(t.params.selected>1?t.params.selected--:t.params.selected=0)}}}}}),angular.module("angular-autocomplete-email").run(["$templateCache",function(e){e.put("input.html",'<div class="container-email"><div class="input-email" ng-mousedown="onMouseDown($event)"><span ng-repeat="email in emails" class="email"><span class="label-email" ng-attr-title="{{email.value}}" ng-dblclick="onEdit(email)" ng-if="!!!email.edit"><span>{{email.label}}</span> <a ng-click="onRemove($index)">x</a></span><form class="form-email" ng-submit="onSubmit(email, true)" ng-if="!!email.edit"><input class="edit-email" type="text" ng-model="params.newValue" ng-blur="onBlur(email)" ng-keydown="onKeyDown($event, email)" ng-keyup="onKeyUp($event, email)" ng-change="onChange()"></form></span></div><ul class="autocomplete-email" ng-if="params.autocompleteFiltered.length"><li ng-repeat="email in params.autocompleteFiltered"><a href="" ng-mousedown="onAddEmail(email)" ng-class="{\'selected\': $index === params.selected}">{{email.value}}</a></li></ul><br><br>{{emails|json}}<br>{{params.newValue|json}}</div>')}]);